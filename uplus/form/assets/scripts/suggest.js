/** * @author  */using("UPlus.Form.ListBox");var Suggest = ListBox.extend({		xType: 'suggest',		_currentIndex: -1,		init: function(options){		this.base('init',  options);		var target = this.target = $(options.target);				target.on('keydown', function(e){						switch(e.keyCode) {				case 40:				case 38:					if(_currentIndex >= 0) {						this.setActived(_currentIndex, false);						current = e.keyCode === 40 ? (current.nextSibling || current.parentNode.firstChild) : (current.previousSibling || current.parentNode.lastChild);					}					$(current).addClass('hover');				    return;				case 13:										if(current) {						sel(current);						return false;					}				case 36:				case 37:				    return;			}					}).keyup(function(e){						switch(e.keyCode) {				case 40:				case 38:				case 13:				case 36:				case 37:				    return;			}					var tx = target.val();						if(!tx)  {				current = null;				return suggest.hide();			}						var json = [];						if(tx.indexOf('@') !== -1){				var u = tx.substr(0, tx.indexOf('@'));								$.each(mails, function () {					if((u + this).indexOf(tx) === 0)						json.push(u + this);				});			} else {				$.each(mails, function () {					json.push(tx + this);				});			}						if(!json.length || (json.length === 1 && json[0] === tx)) {				current = null;				return suggest.hide();			}						suggest.empty().show();						var o = target.offset();						o.top += target.outerHeight()  - 1;						suggest.offset(o);			for(var i = 0; i < json.length; i++) {				suggest.append('<li>' + json[i] + '</li>');			}						current = suggest.find('li')[0];			$(current).addClass('hover');					}).focusout(function(){			setTimeout(function(){				suggest.hide();			}, 200);		});		suggest.mousemove(function(e){			$(current).removeClass('hover');						var s  = e.target;			while(s && s.tagName !== 'LI')				s = s.parentNode;						current = s;			$(current).addClass('hover');		}).mouseleave(function(){			$(current).removeClass('hover');			current = null;		}).click(function(e){			var s  = e.target;									while(s && s.tagName !== 'LI')				s = s.parentNode;						sel(s);		});		function sel(n){		target.val($(n).text());				//  if(n.scrollIntoView)		// 	n.scrollIntoView();				suggest.hide();	}	},	});